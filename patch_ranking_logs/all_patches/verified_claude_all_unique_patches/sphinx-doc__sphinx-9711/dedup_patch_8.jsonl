{"model_name_or_path": "agentless_claude", "instance_id": "sphinx-doc__sphinx-9711", "model_patch": "diff --git a/sphinx/extension.py b/sphinx/extension.py\nindex 6ac780b..684c369 100644\n--- a/sphinx/extension.py\n+++ b/sphinx/extension.py\n@@ -44,6 +44,8 @@ def verify_needs_extensions(app: \"Sphinx\", config: Config) -> None:\n     if config.needs_extensions is None:\n         return\n \n+    from packaging.version import Version, InvalidVersion\n+\n     for extname, reqversion in config.needs_extensions.items():\n         extension = app.extensions.get(extname)\n         if extension is None:\n@@ -51,11 +53,25 @@ def verify_needs_extensions(app: \"Sphinx\", config: Config) -> None:\n                               'but it is not loaded.'), extname)\n             continue\n \n-        if extension.version == 'unknown version' or reqversion > extension.version:\n+        if extension.version == 'unknown version':\n             raise VersionRequirementError(__('This project needs the extension %s at least in '\n                                              'version %s and therefore cannot be built with '\n                                              'the loaded version (%s).') %\n                                           (extname, reqversion, extension.version))\n+        \n+        try:\n+            if Version(reqversion) > Version(extension.version):\n+                raise VersionRequirementError(__('This project needs the extension %s at least in '\n+                                               'version %s and therefore cannot be built with '\n+                                               'the loaded version (%s).') %\n+                                            (extname, reqversion, extension.version))\n+        except InvalidVersion:\n+            # Fall back to string comparison if versions are not PEP 440 compliant\n+            if reqversion > extension.version:\n+                raise VersionRequirementError(__('This project needs the extension %s at least in '\n+                                               'version %s and therefore cannot be built with '\n+                                               'the loaded version (%s).') %\n+                                            (extname, reqversion, extension.version))\n \n \n def setup(app: \"Sphinx\") -> Dict[str, Any]:\n@@ -65,4 +81,4 @@ def setup(app: \"Sphinx\") -> Dict[str, Any]:\n         'version': 'builtin',\n         'parallel_read_safe': True,\n         'parallel_write_safe': True,\n-    }\n+    }\n", "occurrence": 1, "normalized_patch": "diff --git a/sphinx/extension.py b/sphinx/extension.py\nindex 41afac8..43f349e 100644\n--- a/sphinx/extension.py\n+++ b/sphinx/extension.py\n@@ -17,13 +17,20 @@ class Extension:\n def verify_needs_extensions(app: 'Sphinx', config: Config) -> None:\n     if config.needs_extensions is None:\n         return\n+    from packaging.version import Version, InvalidVersion\n     for extname, reqversion in config.needs_extensions.items():\n         extension = app.extensions.get(extname)\n         if extension is None:\n             logger.warning(__('The %s extension is required by needs_extensions settings, but it is not loaded.'), extname)\n             continue\n-        if extension.version == 'unknown version' or reqversion > extension.version:\n+        if extension.version == 'unknown version':\n             raise VersionRequirementError(__('This project needs the extension %s at least in version %s and therefore cannot be built with the loaded version (%s).') % (extname, reqversion, extension.version))\n+        try:\n+            if Version(reqversion) > Version(extension.version):\n+                raise VersionRequirementError(__('This project needs the extension %s at least in version %s and therefore cannot be built with the loaded version (%s).') % (extname, reqversion, extension.version))\n+        except InvalidVersion:\n+            if reqversion > extension.version:\n+                raise VersionRequirementError(__('This project needs the extension %s at least in version %s and therefore cannot be built with the loaded version (%s).') % (extname, reqversion, extension.version))\n def setup(app: 'Sphinx') -> Dict[str, Any]:\n     app.connect('config-inited', verify_needs_extensions, priority=800)\n     return {'version': 'builtin', 'parallel_read_safe': True, 'parallel_write_safe': True}\n\\ No newline at end of file\n", "normalized_occurrence": 1}
