{"model_name_or_path": "agentless_claude", "instance_id": "django__django-16938", "model_patch": "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex 4465765..33a16fa 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -340,9 +340,10 @@ def select_related_descend(field, restricted, requested, select_mask, reverse=Fa\n         return False\n     if (\n         restricted\n-        and select_mask\n+        and select_mask is not None  # Allow None for serialization context\n         and field.name in requested\n         and field not in select_mask\n+        and not getattr(field, 'is_relation', False)  # Skip check for relations\n     ):\n         raise FieldError(\n             f\"Field {field.model._meta.object_name}.{field.name} cannot be both \"\n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex 0f80339..832ce88 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -195,7 +195,7 @@ def select_related_descend(field, restricted, requested, select_mask, reverse=Fa\n             return False\n     if not restricted and field.null:\n         return False\n-    if restricted and select_mask and (field.name in requested) and (field not in select_mask):\n+    if restricted and select_mask is not None and (field.name in requested) and (field not in select_mask) and (not getattr(field, 'is_relation', False)):\n         raise FieldError(f'Field {field.model._meta.object_name}.{field.name} cannot be both deferred and traversed using select_related at the same time.')\n     return True\n def refs_expression(lookup_parts, annotations):\n", "normalized_occurrence": 1}
