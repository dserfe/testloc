{"model_name_or_path": "agentless_claude", "instance_id": "astropy__astropy-14995", "model_patch": "diff --git a/astropy/nddata/mixins/ndarithmetic.py b/astropy/nddata/mixins/ndarithmetic.py\nindex fbb2aba..d985928 100644\n--- a/astropy/nddata/mixins/ndarithmetic.py\n+++ b/astropy/nddata/mixins/ndarithmetic.py\n@@ -512,18 +512,20 @@ class NDArithmeticMixin:\n             If neither had a mask ``None`` is returned. Otherwise\n             ``handle_mask`` must create (and copy) the returned mask.\n         \"\"\"\n-        # If only one mask is present we need not bother about any type checks\n-        if (\n-            self.mask is None and operand is not None and operand.mask is None\n-        ) or handle_mask is None:\n+        # If handle_mask is None, return None\n+        if handle_mask is None:\n             return None\n-        elif self.mask is None and operand is not None:\n-            # Make a copy so there is no reference in the result.\n-            return deepcopy(operand.mask)\n-        elif operand is None:\n+        # If neither has a mask, return None\n+        if self.mask is None and (operand is None or operand.mask is None):\n+            return None\n+        # If self has a mask but operand doesn't (or is None), return a copy of self's mask\n+        elif self.mask is not None and (operand is None or operand.mask is None):\n             return deepcopy(self.mask)\n+        # If operand has a mask but self doesn't, return a copy of operand's mask\n+        elif self.mask is None and operand is not None and operand.mask is not None:\n+            return deepcopy(operand.mask)\n         else:\n-            # Now lets calculate the resulting mask (operation enforces copy)\n+            # Both have masks, so calculate the resulting mask\n             return handle_mask(self.mask, operand.mask, **kwds)\n \n     def _arithmetic_wcs(self, operation, operand, compare_wcs, **kwds):\n", "occurrence": 1, "normalized_patch": "diff --git a/astropy/nddata/mixins/ndarithmetic.py b/astropy/nddata/mixins/ndarithmetic.py\nindex b7eb663..691594f 100644\n--- a/astropy/nddata/mixins/ndarithmetic.py\n+++ b/astropy/nddata/mixins/ndarithmetic.py\n@@ -112,12 +112,14 @@ class NDArithmeticMixin:\n             axis_kwarg = dict(axis=kwds['axis']) if 'axis' in kwds else dict()\n             return self.uncertainty.propagate(operation, operand, result, correlation, **axis_kwarg)\n     def _arithmetic_mask(self, operation, operand, handle_mask, axis=None, **kwds):\n-        if self.mask is None and operand is not None and (operand.mask is None) or handle_mask is None:\n+        if handle_mask is None:\n             return None\n-        elif self.mask is None and operand is not None:\n-            return deepcopy(operand.mask)\n-        elif operand is None:\n+        if self.mask is None and (operand is None or operand.mask is None):\n+            return None\n+        elif self.mask is not None and (operand is None or operand.mask is None):\n             return deepcopy(self.mask)\n+        elif self.mask is None and operand is not None and (operand.mask is not None):\n+            return deepcopy(operand.mask)\n         else:\n             return handle_mask(self.mask, operand.mask, **kwds)\n     def _arithmetic_wcs(self, operation, operand, compare_wcs, **kwds):\n", "normalized_occurrence": 1}
