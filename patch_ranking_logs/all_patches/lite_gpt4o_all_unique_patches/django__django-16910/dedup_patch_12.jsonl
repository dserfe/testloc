{"model_name_or_path": "agentless", "instance_id": "django__django-16910", "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 364ef3b..72f78f2 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -1225,9 +1225,18 @@ class SQLCompiler:\n             select_fields = []\n             _, _, _, joins, _, _ = self.query.setup_joins([f.name], opts, root_alias)\n             alias = joins[-1]\n-            columns = self.get_default_columns(\n-                related_select_mask, start_alias=alias, opts=f.remote_field.model._meta\n-            )\n+            if related_select_mask:\n+                columns = [\n+                    col\n+                    for col in self.get_default_columns(\n+                        related_select_mask, start_alias=alias, opts=f.remote_field.model._meta\n+                    )\n+                    if col[1] in related_select_mask\n+                ]\n+            else:\n+                columns = self.get_default_columns(\n+                    related_select_mask, start_alias=alias, opts=f.remote_field.model._meta\n+                )\n             for col in columns:\n                 select_fields.append(len(select))\n                 select.append((col, None))\n@@ -1278,12 +1287,24 @@ class SQLCompiler:\n                 }\n                 related_klass_infos.append(klass_info)\n                 select_fields = []\n-                columns = self.get_default_columns(\n-                    related_select_mask,\n-                    start_alias=alias,\n-                    opts=model._meta,\n-                    from_parent=opts.model,\n-                )\n+                if related_select_mask:\n+                    columns = [\n+                        col\n+                        for col in self.get_default_columns(\n+                            related_select_mask,\n+                            start_alias=alias,\n+                            opts=model._meta,\n+                            from_parent=opts.model,\n+                        )\n+                        if col[1] in related_select_mask\n+                    ]\n+                else:\n+                    columns = self.get_default_columns(\n+                        related_select_mask,\n+                        start_alias=alias,\n+                        opts=model._meta,\n+                        from_parent=opts.model,\n+                    )\n                 for col in columns:\n                     select_fields.append(len(select))\n                     select.append((col, None))\n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 802130c..4ed56be 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -616,7 +616,10 @@ class SQLCompiler:\n             select_fields = []\n             _, _, _, joins, _, _ = self.query.setup_joins([f.name], opts, root_alias)\n             alias = joins[-1]\n-            columns = self.get_default_columns(related_select_mask, start_alias=alias, opts=f.remote_field.model._meta)\n+            if related_select_mask:\n+                columns = [col for col in self.get_default_columns(related_select_mask, start_alias=alias, opts=f.remote_field.model._meta) if col[1] in related_select_mask]\n+            else:\n+                columns = self.get_default_columns(related_select_mask, start_alias=alias, opts=f.remote_field.model._meta)\n             for col in columns:\n                 select_fields.append(len(select))\n                 select.append((col, None))\n@@ -637,7 +640,10 @@ class SQLCompiler:\n                 klass_info = {'model': model, 'field': related_field, 'reverse': True, 'local_setter': related_field.remote_field.set_cached_value, 'remote_setter': related_field.set_cached_value, 'from_parent': from_parent}\n                 related_klass_infos.append(klass_info)\n                 select_fields = []\n-                columns = self.get_default_columns(related_select_mask, start_alias=alias, opts=model._meta, from_parent=opts.model)\n+                if related_select_mask:\n+                    columns = [col for col in self.get_default_columns(related_select_mask, start_alias=alias, opts=model._meta, from_parent=opts.model) if col[1] in related_select_mask]\n+                else:\n+                    columns = self.get_default_columns(related_select_mask, start_alias=alias, opts=model._meta, from_parent=opts.model)\n                 for col in columns:\n                     select_fields.append(len(select))\n                     select.append((col, None))\n", "normalized_occurrence": 2}
