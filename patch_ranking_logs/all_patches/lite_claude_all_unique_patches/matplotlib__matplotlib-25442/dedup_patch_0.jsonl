{"model_name_or_path": "agentless_claude", "instance_id": "matplotlib__matplotlib-25442", "model_patch": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex db0cc2e..1372056 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1550,11 +1550,17 @@ class DraggableBase:\n                 self.ref_artist.set_animated(False)\n \n     def _check_still_parented(self):\n+        \"\"\"Check if the reference artist is still parented and valid.\"\"\"\n         if self.ref_artist.figure is None:\n+            # Only try to disconnect if we still have access to canvas\n+            if hasattr(self, '_c1'):\n+                try:\n+                    self.canvas.mpl_disconnect(self._c1)\n+                except AttributeError:\n+                    pass  # Canvas may already be gone\n             self.disconnect()\n             return False\n-        else:\n-            return True\n+        return True\n \n     def disconnect(self):\n         \"\"\"Disconnect the callbacks.\"\"\"\n", "occurrence": 1, "normalized_patch": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex f94319f..51088e8 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1301,11 +1301,16 @@ class DraggableBase:\n                 self.ref_artist.set_animated(False)\n \n     def _check_still_parented(self):\n+        \"\"\"Check if the reference artist is still parented and valid.\"\"\"\n         if self.ref_artist.figure is None:\n+            if hasattr(self, '_c1'):\n+                try:\n+                    self.canvas.mpl_disconnect(self._c1)\n+                except AttributeError:\n+                    pass\n             self.disconnect()\n             return False\n-        else:\n-            return True\n+        return True\n \n     def disconnect(self):\n         \"\"\"Disconnect the callbacks.\"\"\"\n", "normalized_occurrence": 1}
