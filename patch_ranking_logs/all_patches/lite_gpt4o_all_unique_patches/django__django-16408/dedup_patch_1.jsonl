{"model_name_or_path": "agentless", "instance_id": "django__django-16408", "model_patch": "diff --git a/django/db/models/query.py b/django/db/models/query.py\nindex 490b14c..768db44 100644\n--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -1538,7 +1538,12 @@ class QuerySet(AltersData):\n         if fields == (None,):\n             obj.query.select_related = False\n         elif fields:\n-            obj.query.add_select_related(fields)\n+            for field in fields:\n+                related_lookups = field.split(LOOKUP_SEP)\n+                filtered_relation = obj.query._filtered_relations.get(related_lookups[0])\n+                if filtered_relation:\n+                    obj.query.add_select_related([filtered_relation.relation_name])\n+                obj.query.add_select_related(fields)\n         else:\n             obj.query.select_related = True\n         return obj\n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/models/query.py b/django/db/models/query.py\nindex aec69ea..3df911c 100644\n--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -826,7 +826,12 @@ class QuerySet(AltersData):\n         if fields == (None,):\n             obj.query.select_related = False\n         elif fields:\n-            obj.query.add_select_related(fields)\n+            for field in fields:\n+                related_lookups = field.split(LOOKUP_SEP)\n+                filtered_relation = obj.query._filtered_relations.get(related_lookups[0])\n+                if filtered_relation:\n+                    obj.query.add_select_related([filtered_relation.relation_name])\n+                obj.query.add_select_related(fields)\n         else:\n             obj.query.select_related = True\n         return obj\n", "normalized_occurrence": 1}
