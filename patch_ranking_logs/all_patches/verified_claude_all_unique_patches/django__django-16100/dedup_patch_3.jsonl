{"model_name_or_path": "agentless_claude", "instance_id": "django__django-16100", "model_patch": "diff --git a/django/contrib/admin/options.py b/django/contrib/admin/options.py\nindex 32995ac..6ea391f 100644\n--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -1998,6 +1998,8 @@ class ModelAdmin(BaseModelAdmin):\n         # use the formset to validate/process POSTed data.\n         formset = cl.formset = None\n \n+        from django.db import transaction\n+\n         # Handle POSTed bulk-edit data.\n         if request.method == \"POST\" and cl.list_editable and \"_save\" in request.POST:\n             if not self.has_change_permission(request):\n@@ -2011,14 +2013,15 @@ class ModelAdmin(BaseModelAdmin):\n             )\n             if formset.is_valid():\n                 changecount = 0\n-                for form in formset.forms:\n-                    if form.has_changed():\n-                        obj = self.save_form(request, form, change=True)\n-                        self.save_model(request, obj, form, change=True)\n-                        self.save_related(request, form, formsets=[], change=True)\n-                        change_msg = self.construct_change_message(request, form, None)\n-                        self.log_change(request, obj, change_msg)\n-                        changecount += 1\n+                with transaction.atomic():\n+                    for form in formset.forms:\n+                        if form.has_changed():\n+                            obj = self.save_form(request, form, change=True)\n+                            self.save_model(request, obj, form, change=True)\n+                            self.save_related(request, form, formsets=[], change=True)\n+                            change_msg = self.construct_change_message(request, form, None)\n+                            self.log_change(request, obj, change_msg)\n+                            changecount += 1\n \n                 if changecount:\n                     msg = ngettext(\n", "occurrence": 1, "normalized_patch": "diff --git a/django/contrib/admin/options.py b/django/contrib/admin/options.py\nindex 6c1421c..3e15001 100644\n--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -848,6 +848,7 @@ class ModelAdmin(BaseModelAdmin):\n         if action_failed:\n             return HttpResponseRedirect(request.get_full_path())\n         formset = cl.formset = None\n+        from django.db import transaction\n         if request.method == 'POST' and cl.list_editable and ('_save' in request.POST):\n             if not self.has_change_permission(request):\n                 raise PermissionDenied\n@@ -856,14 +857,15 @@ class ModelAdmin(BaseModelAdmin):\n             formset = cl.formset = FormSet(request.POST, request.FILES, queryset=modified_objects)\n             if formset.is_valid():\n                 changecount = 0\n-                for form in formset.forms:\n-                    if form.has_changed():\n-                        obj = self.save_form(request, form, change=True)\n-                        self.save_model(request, obj, form, change=True)\n-                        self.save_related(request, form, formsets=[], change=True)\n-                        change_msg = self.construct_change_message(request, form, None)\n-                        self.log_change(request, obj, change_msg)\n-                        changecount += 1\n+                with transaction.atomic():\n+                    for form in formset.forms:\n+                        if form.has_changed():\n+                            obj = self.save_form(request, form, change=True)\n+                            self.save_model(request, obj, form, change=True)\n+                            self.save_related(request, form, formsets=[], change=True)\n+                            change_msg = self.construct_change_message(request, form, None)\n+                            self.log_change(request, obj, change_msg)\n+                            changecount += 1\n                 if changecount:\n                     msg = ngettext('%(count)s %(name)s was changed successfully.', '%(count)s %(name)s were changed successfully.', changecount) % {'count': changecount, 'name': model_ngettext(self.opts, changecount)}\n                     self.message_user(request, msg, messages.SUCCESS)\n", "normalized_occurrence": 1}
