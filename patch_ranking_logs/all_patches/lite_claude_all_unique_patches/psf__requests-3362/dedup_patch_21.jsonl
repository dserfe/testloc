{"model_name_or_path": "agentless_claude", "instance_id": "psf__requests-3362", "model_patch": "diff --git a/requests/utils.py b/requests/utils.py\nindex 177dcd1..9dc6786 100644\n--- a/requests/utils.py\n+++ b/requests/utils.py\n@@ -359,12 +359,24 @@ def get_encoding_from_headers(headers):\n def stream_decode_response_unicode(iterator, r):\n     \"\"\"Stream decodes a iterator.\"\"\"\n \n-    if r.encoding is None:\n-        for item in iterator:\n-            yield item\n-        return\n+    encoding = r.encoding\n+\n+    if encoding is None:\n+        # Try to detect the encoding from the first chunk\n+        first_chunk = next(iterator, None)\n+        if first_chunk is not None:\n+            encoding = chardet.detect(first_chunk)['encoding']\n+            if encoding is None:\n+                encoding = 'utf-8'  # fallback to utf-8\n+            # Don't forget to process the first chunk\n+            decoder = codecs.getincrementaldecoder(encoding)(errors='replace')\n+            rv = decoder.decode(first_chunk)\n+            if rv:\n+                yield rv\n+        else:\n+            return\n \n-    decoder = codecs.getincrementaldecoder(r.encoding)(errors='replace')\n+    decoder = codecs.getincrementaldecoder(encoding)(errors='replace')\n     for chunk in iterator:\n         rv = decoder.decode(chunk)\n         if rv:\n", "occurrence": 1, "normalized_patch": "diff --git a/requests/utils.py b/requests/utils.py\nindex 9f5088a..3fdc989 100644\n--- a/requests/utils.py\n+++ b/requests/utils.py\n@@ -141,11 +141,20 @@ def get_encoding_from_headers(headers):\n     if 'text' in content_type:\n         return 'ISO-8859-1'\n def stream_decode_response_unicode(iterator, r):\n-    if r.encoding is None:\n-        for item in iterator:\n-            yield item\n-        return\n-    decoder = codecs.getincrementaldecoder(r.encoding)(errors='replace')\n+    encoding = r.encoding\n+    if encoding is None:\n+        first_chunk = next(iterator, None)\n+        if first_chunk is not None:\n+            encoding = chardet.detect(first_chunk)['encoding']\n+            if encoding is None:\n+                encoding = 'utf-8'\n+            decoder = codecs.getincrementaldecoder(encoding)(errors='replace')\n+            rv = decoder.decode(first_chunk)\n+            if rv:\n+                yield rv\n+        else:\n+            return\n+    decoder = codecs.getincrementaldecoder(encoding)(errors='replace')\n     for chunk in iterator:\n         rv = decoder.decode(chunk)\n         if rv:\n", "normalized_occurrence": 1}
