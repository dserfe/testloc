{"model_name_or_path": "agentless", "instance_id": "django__django-11477", "model_patch": "diff --git a/django/urls/resolvers.py b/django/urls/resolvers.py\nindex 58da200..ef6fdde 100644\n--- a/django/urls/resolvers.py\n+++ b/django/urls/resolvers.py\n@@ -469,13 +469,19 @@ class URLResolver:\n                         for name in url_pattern.reverse_dict:\n                             for matches, pat, defaults, converters in url_pattern.reverse_dict.getlist(name):\n                                 new_matches = normalize(p_pattern + pat)\n+                                combined_defaults = {**defaults, **url_pattern.default_kwargs}\n+                                combined_converters = {**self.pattern.converters, **url_pattern.pattern.converters, **converters}\n+                                # Ensure optional named groups are handled correctly\n+                                for key in combined_defaults:\n+                                    if key not in combined_converters:\n+                                        combined_converters[key] = None\n                                 lookups.appendlist(\n                                     name,\n                                     (\n                                         new_matches,\n                                         p_pattern + pat,\n-                                        {**defaults, **url_pattern.default_kwargs},\n-                                        {**self.pattern.converters, **url_pattern.pattern.converters, **converters}\n+                                        combined_defaults,\n+                                        combined_converters\n                                     )\n                                 )\n                         for namespace, (prefix, sub_pattern) in url_pattern.namespace_dict.items():\n", "occurrence": 1, "normalized_patch": "diff --git a/django/urls/resolvers.py b/django/urls/resolvers.py\nindex e10e0e8..6835d27 100644\n--- a/django/urls/resolvers.py\n+++ b/django/urls/resolvers.py\n@@ -297,7 +297,12 @@ class URLResolver:\n                         for name in url_pattern.reverse_dict:\n                             for matches, pat, defaults, converters in url_pattern.reverse_dict.getlist(name):\n                                 new_matches = normalize(p_pattern + pat)\n-                                lookups.appendlist(name, (new_matches, p_pattern + pat, {**defaults, **url_pattern.default_kwargs}, {**self.pattern.converters, **url_pattern.pattern.converters, **converters}))\n+                                combined_defaults = {**defaults, **url_pattern.default_kwargs}\n+                                combined_converters = {**self.pattern.converters, **url_pattern.pattern.converters, **converters}\n+                                for key in combined_defaults:\n+                                    if key not in combined_converters:\n+                                        combined_converters[key] = None\n+                                lookups.appendlist(name, (new_matches, p_pattern + pat, combined_defaults, combined_converters))\n                         for namespace, (prefix, sub_pattern) in url_pattern.namespace_dict.items():\n                             current_converters = url_pattern.pattern.converters\n                             sub_pattern.pattern.converters.update(current_converters)\n", "normalized_occurrence": 1}
