{"model_name_or_path": "agentless", "instance_id": "django__django-16910", "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 364ef3b..a64b490 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -1225,9 +1225,14 @@ class SQLCompiler:\n             select_fields = []\n             _, _, _, joins, _, _ = self.query.setup_joins([f.name], opts, root_alias)\n             alias = joins[-1]\n-            columns = self.get_default_columns(\n-                related_select_mask, start_alias=alias, opts=f.remote_field.model._meta\n-            )\n+            if restricted and related_select_mask:\n+                columns = self.get_default_columns(\n+                    related_select_mask, start_alias=alias, opts=f.remote_field.model._meta\n+                )\n+            else:\n+                columns = self.get_default_columns(\n+                    {}, start_alias=alias, opts=f.remote_field.model._meta\n+                )\n             for col in columns:\n                 select_fields.append(len(select))\n                 select.append((col, None))\n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 802130c..c3ac913 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -616,7 +616,10 @@ class SQLCompiler:\n             select_fields = []\n             _, _, _, joins, _, _ = self.query.setup_joins([f.name], opts, root_alias)\n             alias = joins[-1]\n-            columns = self.get_default_columns(related_select_mask, start_alias=alias, opts=f.remote_field.model._meta)\n+            if restricted and related_select_mask:\n+                columns = self.get_default_columns(related_select_mask, start_alias=alias, opts=f.remote_field.model._meta)\n+            else:\n+                columns = self.get_default_columns({}, start_alias=alias, opts=f.remote_field.model._meta)\n             for col in columns:\n                 select_fields.append(len(select))\n                 select.append((col, None))\n", "normalized_occurrence": 1}
