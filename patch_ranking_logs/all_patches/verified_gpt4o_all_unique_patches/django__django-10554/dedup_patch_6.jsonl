{"model_name_or_path": "agentless", "instance_id": "django__django-10554", "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex ab425fb..22d76b0 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -362,11 +362,12 @@ class SQLCompiler:\n             # not taken into account so we strip it. When this entire method\n             # is refactored into expressions, then we can check each part as we\n             # generate it.\n-            without_ordering = self.ordering_parts.search(sql).group(1)\n-            params_hash = make_hashable(params)\n-            if (without_ordering, params_hash) in seen:\n-                continue\n-            seen.add((without_ordering, params_hash))\n+            if not self.query.combinator:\n+                without_ordering = self.ordering_parts.search(sql).group(1)\n+                params_hash = make_hashable(params)\n+                if (without_ordering, params_hash) in seen:\n+                    continue\n+                seen.add((without_ordering, params_hash))\n             result.append((resolved, (sql, params, is_ref)))\n         return result\n \n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 0a7444d..14f7052 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -194,11 +194,12 @@ class SQLCompiler:\n                 else:\n                     raise DatabaseError('ORDER BY term does not match any column in the result set.')\n             sql, params = self.compile(resolved)\n-            without_ordering = self.ordering_parts.search(sql).group(1)\n-            params_hash = make_hashable(params)\n-            if (without_ordering, params_hash) in seen:\n-                continue\n-            seen.add((without_ordering, params_hash))\n+            if not self.query.combinator:\n+                without_ordering = self.ordering_parts.search(sql).group(1)\n+                params_hash = make_hashable(params)\n+                if (without_ordering, params_hash) in seen:\n+                    continue\n+                seen.add((without_ordering, params_hash))\n             result.append((resolved, (sql, params, is_ref)))\n         return result\n     def get_extra_select(self, order_by, select):\n", "normalized_occurrence": 1}
