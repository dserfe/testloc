{"model_name_or_path": "agentless_claude", "instance_id": "sympy__sympy-13915", "model_patch": "diff --git a/sympy/core/function.py b/sympy/core/function.py\nindex 30870a1..4982379 100644\n--- a/sympy/core/function.py\n+++ b/sympy/core/function.py\n@@ -1862,8 +1862,18 @@ class Subs(Expr):\n     def _eval_subs(self, old, new):\n         if old in self.variables:\n             if old in self.point:\n-                newpoint = tuple(new if i == old else i for i in self.point)\n-                return self.func(self.expr, self.variables, newpoint)\n+                # Check if substitution would lead to undefined expression\n+                try:\n+                    from sympy.core.numbers import ComplexInfinity, NaN\n+                    test_expr = self.expr.subs(old, new)\n+                    if test_expr.has(ComplexInfinity) or test_expr.has(NaN):\n+                        from sympy import nan\n+                        return nan\n+                    newpoint = tuple(new if i == old else i for i in self.point)\n+                    return self.func(self.expr, self.variables, newpoint)\n+                except ZeroDivisionError:\n+                    from sympy import nan\n+                    return nan\n             return self\n \n     def _eval_derivative(self, s):\n", "occurrence": 1, "normalized_patch": "diff --git a/sympy/core/function.py b/sympy/core/function.py\nindex 209c1c6..8ade74e 100644\n--- a/sympy/core/function.py\n+++ b/sympy/core/function.py\n@@ -768,8 +768,17 @@ class Subs(Expr):\n     def _eval_subs(self, old, new):\n         if old in self.variables:\n             if old in self.point:\n-                newpoint = tuple((new if i == old else i for i in self.point))\n-                return self.func(self.expr, self.variables, newpoint)\n+                try:\n+                    from sympy.core.numbers import ComplexInfinity, NaN\n+                    test_expr = self.expr.subs(old, new)\n+                    if test_expr.has(ComplexInfinity) or test_expr.has(NaN):\n+                        from sympy import nan\n+                        return nan\n+                    newpoint = tuple((new if i == old else i for i in self.point))\n+                    return self.func(self.expr, self.variables, newpoint)\n+                except ZeroDivisionError:\n+                    from sympy import nan\n+                    return nan\n             return self\n     def _eval_derivative(self, s):\n         val = Add.fromiter((p.diff(s) * Subs(self.expr.diff(v), self.variables, self.point).doit() for v, p in zip(self.variables, self.point)))\n", "normalized_occurrence": 1}
