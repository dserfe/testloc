{"model_name_or_path": "agentless_claude", "instance_id": "scikit-learn__scikit-learn-25931", "model_patch": "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..0acfdd4 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Store feature names before validation if present\n+        self.feature_names_in_ = getattr(X, \"columns\", None)\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,13 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Create DataFrame with original feature names for internal scoring if needed\n+        if hasattr(self, 'feature_names_in_') and self.feature_names_in_ is not None:\n+            import pandas as pd\n+            X_score = pd.DataFrame(X, columns=self.feature_names_in_)\n+        else:\n+            X_score = X\n+        self.offset_ = np.percentile(self.score_samples(X_score), 100.0 * self.contamination)\n \n         return self\n \n", "occurrence": 1, "normalized_patch": "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex f9e64b9..163c4db 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -23,6 +23,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n         return {'prefer': 'threads'}\n     def fit(self, X, y=None, sample_weight=None):\n         self._validate_params()\n+        self.feature_names_in_ = getattr(X, 'columns', None)\n         X = self._validate_data(X, accept_sparse=['csc'], dtype=tree_dtype)\n         if issparse(X):\n             X.sort_indices()\n@@ -46,7 +47,12 @@ class IsolationForest(OutlierMixin, BaseBagging):\n         if self.contamination == 'auto':\n             self.offset_ = -0.5\n             return self\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        if hasattr(self, 'feature_names_in_') and self.feature_names_in_ is not None:\n+            import pandas as pd\n+            X_score = pd.DataFrame(X, columns=self.feature_names_in_)\n+        else:\n+            X_score = X\n+        self.offset_ = np.percentile(self.score_samples(X_score), 100.0 * self.contamination)\n         return self\n     def predict(self, X):\n         check_is_fitted(self)\n", "normalized_occurrence": 1}
