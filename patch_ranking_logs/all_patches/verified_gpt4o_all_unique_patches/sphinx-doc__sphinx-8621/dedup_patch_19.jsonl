{"model_name_or_path": "agentless", "instance_id": "sphinx-doc__sphinx-8621", "model_patch": "diff --git a/sphinx/roles.py b/sphinx/roles.py\nindex 307975f..aed0c2b 100644\n--- a/sphinx/roles.py\n+++ b/sphinx/roles.py\n@@ -32,6 +32,8 @@ if False:\n     from sphinx.environment import BuildEnvironment\n \n \n+from docutils import nodes\n+\n generic_docroles = {\n     'command': addnodes.literal_strong,\n     'dfn': nodes.emphasis,\n@@ -45,6 +47,51 @@ generic_docroles = {\n     'regexp': nodes.literal,\n }\n \n+def parse_kbd_content(content):\n+    # Split the content manually to handle special characters properly\n+    parts = []\n+    part = ''\n+    in_keystroke = False\n+    for char in content:\n+        if char in '-+^':\n+            if in_keystroke:\n+                part += char\n+            else:\n+                if part:\n+                    parts.append(part)\n+                parts.append(char)\n+                part = ''\n+        else:\n+            if char.isalnum():\n+                if not in_keystroke and part:\n+                    parts.append(part)\n+                    part = ''\n+                part += char\n+                in_keystroke = True\n+            else:\n+                if part:\n+                    parts.append(part)\n+                parts.append(char)\n+                part = ''\n+                in_keystroke = False\n+\n+    if part:\n+        parts.append(part)\n+    \n+    return parts\n+\n+def visit_kbd_role(name, rawtext, text, lineno, inliner, options={}, content=[]):\n+    parts = parse_kbd_content(text)\n+    node = nodes.inline(rawtext, '', classes=['kbd'])\n+    for part in parts:\n+        if part in '-+^':\n+            node += nodes.Text(part)\n+        else:\n+            node += nodes.inline(part, part, classes=['literal', 'notranslate'])\n+    return [node], []\n+\n+roles.register_local_role('kbd', visit_kbd_role)\n+\n \n # -- generic cross-reference role ----------------------------------------------\n \n", "occurrence": 1, "normalized_patch": "--- a/sphinx/roles.py\n+++ b/sphinx/roles.py\n+from docutils import nodes\n+def parse_kbd_content(content):\n+    parts = []\n+    part = ''\n+    in_keystroke = False\n+    for char in content:\n+        if char in '-+^':\n+            if in_keystroke:\n+                part += char\n+            else:\n+                if part:\n+                    parts.append(part)\n+                parts.append(char)\n+                part = ''\n+        elif char.isalnum():\n+            if not in_keystroke and part:\n+                parts.append(part)\n+                part = ''\n+            part += char\n+            in_keystroke = True\n+        else:\n+            if part:\n+                parts.append(part)\n+            parts.append(char)\n+            part = ''\n+            in_keystroke = False\n+    if part:\n+        parts.append(part)\n+    return parts\n+def visit_kbd_role(name, rawtext, text, lineno, inliner, options={}, content=[]):\n+    parts = parse_kbd_content(text)\n+    node = nodes.inline(rawtext, '', classes=['kbd'])\n+    for part in parts:\n+        if part in '-+^':\n+            node += nodes.Text(part)\n+        else:\n+            node += nodes.inline(part, part, classes=['literal', 'notranslate'])\n+    return ([node], [])\n+roles.register_local_role('kbd', visit_kbd_role)", "normalized_occurrence": 1}
