{"model_name_or_path": "agentless", "instance_id": "psf__requests-6028", "model_patch": "diff --git a/requests/sessions.py b/requests/sessions.py\nindex 594e72b..f8be056 100644\n--- a/requests/sessions.py\n+++ b/requests/sessions.py\n@@ -516,6 +516,13 @@ class Session(SessionRedirectMixin):\n \n         proxies = proxies or {}\n \n+        # If proxies are provided, ensure the Proxy-Authorization header is set correctly\n+        if proxies:\n+            proxy_auth = self.auth\n+            for proxy in proxies.values():\n+                if '@' in proxy:\n+                    proxy_auth = HTTPProxyAuth(*proxy.split('@')[0].split(':'))\n+\n         settings = self.merge_environment_settings(\n             prep.url, proxies, stream, verify, cert\n         )\n@@ -524,6 +531,7 @@ class Session(SessionRedirectMixin):\n         send_kwargs = {\n             'timeout': timeout,\n             'allow_redirects': allow_redirects,\n+            'auth': proxy_auth\n         }\n         send_kwargs.update(settings)\n         resp = self.send(prep, **send_kwargs)\n", "occurrence": 1, "normalized_patch": "diff --git a/requests/sessions.py b/requests/sessions.py\nindex 65aa332..0d73642 100644\n--- a/requests/sessions.py\n+++ b/requests/sessions.py\n@@ -182,8 +182,13 @@ class Session(SessionRedirectMixin):\n         req = Request(method=method.upper(), url=url, headers=headers, files=files, data=data or {}, json=json, params=params or {}, auth=auth, cookies=cookies, hooks=hooks)\n         prep = self.prepare_request(req)\n         proxies = proxies or {}\n+        if proxies:\n+            proxy_auth = self.auth\n+            for proxy in proxies.values():\n+                if '@' in proxy:\n+                    proxy_auth = HTTPProxyAuth(*proxy.split('@')[0].split(':'))\n         settings = self.merge_environment_settings(prep.url, proxies, stream, verify, cert)\n-        send_kwargs = {'timeout': timeout, 'allow_redirects': allow_redirects}\n+        send_kwargs = {'timeout': timeout, 'allow_redirects': allow_redirects, 'auth': proxy_auth}\n         send_kwargs.update(settings)\n         resp = self.send(prep, **send_kwargs)\n         return resp\n", "normalized_occurrence": 1}
