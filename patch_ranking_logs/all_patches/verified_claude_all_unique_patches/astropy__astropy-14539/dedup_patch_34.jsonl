{"model_name_or_path": "agentless_claude", "instance_id": "astropy__astropy-14539", "model_patch": "diff --git a/astropy/io/fits/diff.py b/astropy/io/fits/diff.py\nindex 0a08301..e01c6ed 100644\n--- a/astropy/io/fits/diff.py\n+++ b/astropy/io/fits/diff.py\n@@ -1450,15 +1450,21 @@ class TableDataDiff(_BaseDiff):\n             ):\n                 diffs = where_not_allclose(arra, arrb, rtol=self.rtol, atol=self.atol)\n             elif \"P\" in col.format:\n-                diffs = (\n-                    [\n-                        idx\n-                        for idx in range(len(arra))\n-                        if not np.allclose(\n-                            arra[idx], arrb[idx], rtol=self.rtol, atol=self.atol\n+                # Handle Variable Length Arrays (VLAs)\n+                diffs = [\n+                    idx\n+                    for idx in range(len(arra))\n+                    if (\n+                        len(arra[idx]) != len(arrb[idx])\n+                        or not np.array_equal(arra[idx], arrb[idx])\n+                        or not (\n+                            np.allclose(arra[idx], arrb[idx], rtol=self.rtol, atol=self.atol)\n+                            if arra[idx].size > 0 and arrb[idx].size > 0\n+                            else True\n                         )\n-                    ],\n-                )\n+                    )\n+                ]\n+                diffs = (np.array(diffs),)\n             else:\n                 diffs = np.where(arra != arrb)\n \n", "normalized_patch": "diff --git a/astropy/io/fits/diff.py b/astropy/io/fits/diff.py\nindex 0555397..01d76b7 100644\n--- a/astropy/io/fits/diff.py\n+++ b/astropy/io/fits/diff.py\n@@ -519,7 +519,8 @@ class TableDataDiff(_BaseDiff):\n             if np.issubdtype(arra.dtype, np.floating) and np.issubdtype(arrb.dtype, np.floating):\n                 diffs = where_not_allclose(arra, arrb, rtol=self.rtol, atol=self.atol)\n             elif 'P' in col.format:\n-                diffs = ([idx for idx in range(len(arra)) if not np.allclose(arra[idx], arrb[idx], rtol=self.rtol, atol=self.atol)],)\n+                diffs = [idx for idx in range(len(arra)) if len(arra[idx]) != len(arrb[idx]) or not np.array_equal(arra[idx], arrb[idx]) or (not (np.allclose(arra[idx], arrb[idx], rtol=self.rtol, atol=self.atol) if arra[idx].size > 0 and arrb[idx].size > 0 else True))]\n+                diffs = (np.array(diffs),)\n             else:\n                 diffs = np.where(arra != arrb)\n             self.diff_total += len(set(diffs[0]))\n", "normalized_occurrence": 1}
