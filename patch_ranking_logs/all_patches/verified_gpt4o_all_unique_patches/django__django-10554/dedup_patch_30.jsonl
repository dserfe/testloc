{"model_name_or_path": "agentless", "instance_id": "django__django-10554", "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex ab425fb..c45de9e 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -418,7 +418,11 @@ class SQLCompiler:\n                 if query.low_mark or query.high_mark:\n                     raise DatabaseError('LIMIT/OFFSET not allowed in subqueries of compound statements.')\n                 if compiler.get_order_by():\n-                    raise DatabaseError('ORDER BY not allowed in subqueries of compound statements.')\n+                    order_by = compiler.get_order_by()\n+                    # Ensure all ORDER BY columns are included in the SELECT clause.\n+                    for expr, (sql, params, is_ref) in order_by:\n+                        if not is_ref:\n+                            compiler.query.add_select(expr)\n         parts = ()\n         for compiler in compilers:\n             try:\n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 0a7444d..ebaa49d 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -236,7 +236,10 @@ class SQLCompiler:\n                 if query.low_mark or query.high_mark:\n                     raise DatabaseError('LIMIT/OFFSET not allowed in subqueries of compound statements.')\n                 if compiler.get_order_by():\n-                    raise DatabaseError('ORDER BY not allowed in subqueries of compound statements.')\n+                    order_by = compiler.get_order_by()\n+                    for expr, (sql, params, is_ref) in order_by:\n+                        if not is_ref:\n+                            compiler.query.add_select(expr)\n         parts = ()\n         for compiler in compilers:\n             try:\n", "normalized_occurrence": 1}
