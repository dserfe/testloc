{"model_name_or_path": "agentless_claude", "instance_id": "django__django-11740", "model_patch": "diff --git a/django/db/migrations/autodetector.py b/django/db/migrations/autodetector.py\nindex 816737e..203790b 100644\n--- a/django/db/migrations/autodetector.py\n+++ b/django/db/migrations/autodetector.py\n@@ -963,15 +963,19 @@ class MigrationAutodetector:\n                             preserve_default = False\n                     else:\n                         field = new_field\n-                    self.add_operation(\n-                        app_label,\n-                        operations.AlterField(\n+                    # Add dependencies if changing to a ForeignKey\n+                    if hasattr(new_field, 'remote_field') and new_field.remote_field and not hasattr(old_field, 'remote_field'):\n+                        dependencies = self._get_dependencies_for_foreign_key(new_field)\n+                    alter_field_operation = operations.AlterField(\n                             model_name=model_name,\n                             name=field_name,\n                             field=field,\n                             preserve_default=preserve_default,\n                         )\n-                    )\n+                    # If we added dependencies for a new foreign key, attach them to the operation\n+                    if 'dependencies' in locals():\n+                        alter_field_operation.dependencies = dependencies\n+                    self.add_operation(app_label, alter_field_operation)\n                 else:\n                     # We cannot alter between m2m and concrete fields\n                     self._generate_removed_field(app_label, model_name, field_name)\n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/migrations/autodetector.py b/django/db/migrations/autodetector.py\nindex 9fda64b..cf5eff4 100644\n--- a/django/db/migrations/autodetector.py\n+++ b/django/db/migrations/autodetector.py\n@@ -468,7 +468,12 @@ class MigrationAutodetector:\n                             preserve_default = False\n                     else:\n                         field = new_field\n-                    self.add_operation(app_label, operations.AlterField(model_name=model_name, name=field_name, field=field, preserve_default=preserve_default))\n+                    if hasattr(new_field, 'remote_field') and new_field.remote_field and (not hasattr(old_field, 'remote_field')):\n+                        dependencies = self._get_dependencies_for_foreign_key(new_field)\n+                    alter_field_operation = operations.AlterField(model_name=model_name, name=field_name, field=field, preserve_default=preserve_default)\n+                    if 'dependencies' in locals():\n+                        alter_field_operation.dependencies = dependencies\n+                    self.add_operation(app_label, alter_field_operation)\n                 else:\n                     self._generate_removed_field(app_label, model_name, field_name)\n                     self._generate_added_field(app_label, model_name, field_name)\n", "normalized_occurrence": 1}
