{"model_name_or_path": "agentless_claude", "instance_id": "sphinx-doc__sphinx-10323", "model_patch": "diff --git a/sphinx/directives/code.py b/sphinx/directives/code.py\nindex 2bf31d0..e33372f 100644\n--- a/sphinx/directives/code.py\n+++ b/sphinx/directives/code.py\n@@ -340,26 +340,44 @@ class LiteralIncludeReader:\n \n         return lines\n \n+    def dedent_filter(self, lines: List[str], location: Tuple[str, int] = None) -> List[str]:\n+        if 'dedent' in self.options:\n+            return dedent_lines(lines, self.options.get('dedent'), location=location)\n+        else:\n+            return lines\n+\n     def prepend_filter(self, lines: List[str], location: Tuple[str, int] = None) -> List[str]:\n         prepend = self.options.get('prepend')\n         if prepend:\n-            lines.insert(0, prepend + '\\n')\n-\n+            # If dedent was applied, we need to add the same indentation to prepended content\n+            if 'dedent' in self.options:\n+                dedent_amount = self.options.get('dedent')\n+                if lines and len(lines[0]) >= dedent_amount:\n+                    # Use the same indentation as the first line after dedent\n+                    indentation = ' ' * dedent_amount\n+                    lines.insert(0, indentation + prepend + '\\n')\n+                else:\n+                    lines.insert(0, prepend + '\\n')\n+            else:\n+                lines.insert(0, prepend + '\\n')\n         return lines\n \n     def append_filter(self, lines: List[str], location: Tuple[str, int] = None) -> List[str]:\n         append = self.options.get('append')\n         if append:\n-            lines.append(append + '\\n')\n-\n+            # If dedent was applied, we need to add the same indentation to appended content\n+            if 'dedent' in self.options:\n+                dedent_amount = self.options.get('dedent')\n+                if lines and len(lines[-1]) >= dedent_amount:\n+                    # Use the same indentation as the last line after dedent\n+                    indentation = ' ' * dedent_amount\n+                    lines.append(indentation + append + '\\n')\n+                else:\n+                    lines.append(append + '\\n')\n+            else:\n+                lines.append(append + '\\n')\n         return lines\n \n-    def dedent_filter(self, lines: List[str], location: Tuple[str, int] = None) -> List[str]:\n-        if 'dedent' in self.options:\n-            return dedent_lines(lines, self.options.get('dedent'), location=location)\n-        else:\n-            return lines\n-\n \n class LiteralInclude(SphinxDirective):\n     \"\"\"\n", "normalized_patch": "diff --git a/sphinx/directives/code.py b/sphinx/directives/code.py\nindex 15cdcaf..c02a310 100644\n--- a/sphinx/directives/code.py\n+++ b/sphinx/directives/code.py\n@@ -223,21 +223,37 @@ class LiteralIncludeReader:\n             else:\n                 raise ValueError('end-before pattern not found: %s' % end)\n         return lines\n+    def dedent_filter(self, lines: List[str], location: Tuple[str, int]=None) -> List[str]:\n+        if 'dedent' in self.options:\n+            return dedent_lines(lines, self.options.get('dedent'), location=location)\n+        else:\n+            return lines\n     def prepend_filter(self, lines: List[str], location: Tuple[str, int]=None) -> List[str]:\n         prepend = self.options.get('prepend')\n         if prepend:\n-            lines.insert(0, prepend + '\\n')\n+            if 'dedent' in self.options:\n+                dedent_amount = self.options.get('dedent')\n+                if lines and len(lines[0]) >= dedent_amount:\n+                    indentation = ' ' * dedent_amount\n+                    lines.insert(0, indentation + prepend + '\\n')\n+                else:\n+                    lines.insert(0, prepend + '\\n')\n+            else:\n+                lines.insert(0, prepend + '\\n')\n         return lines\n     def append_filter(self, lines: List[str], location: Tuple[str, int]=None) -> List[str]:\n         append = self.options.get('append')\n         if append:\n-            lines.append(append + '\\n')\n+            if 'dedent' in self.options:\n+                dedent_amount = self.options.get('dedent')\n+                if lines and len(lines[-1]) >= dedent_amount:\n+                    indentation = ' ' * dedent_amount\n+                    lines.append(indentation + append + '\\n')\n+                else:\n+                    lines.append(append + '\\n')\n+            else:\n+                lines.append(append + '\\n')\n         return lines\n-    def dedent_filter(self, lines: List[str], location: Tuple[str, int]=None) -> List[str]:\n-        if 'dedent' in self.options:\n-            return dedent_lines(lines, self.options.get('dedent'), location=location)\n-        else:\n-            return lines\n class LiteralInclude(SphinxDirective):\n     has_content = False\n     required_arguments = 1\n", "normalized_occurrence": 1}
