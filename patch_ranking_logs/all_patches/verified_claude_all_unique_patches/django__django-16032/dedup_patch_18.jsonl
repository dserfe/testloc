{"model_name_or_path": "agentless_claude", "instance_id": "django__django-16032", "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 006c631..d59f6da 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -276,10 +276,12 @@ class SQLCompiler:\n                 \"model\": self.query.model,\n                 \"select_fields\": select_list,\n             }\n-        for alias, annotation in self.query.annotation_select.items():\n-            annotations[alias] = select_idx\n-            select.append((annotation, alias))\n-            select_idx += 1\n+        # Only include annotations if this isn't a subquery for an IN clause\n+        if not getattr(self.query, 'subquery', False) or not self.query.is_empty():\n+            for alias, annotation in self.query.annotation_select.items():\n+                annotations[alias] = select_idx\n+                select.append((annotation, alias))\n+                select_idx += 1\n \n         if self.query.select_related:\n             related_klass_infos = self.get_related_selections(select, select_mask)\n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex e16cf4a..ffbcab3 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -119,10 +119,11 @@ class SQLCompiler:\n                 select.append((col, None))\n                 select_idx += 1\n             klass_info = {'model': self.query.model, 'select_fields': select_list}\n-        for alias, annotation in self.query.annotation_select.items():\n-            annotations[alias] = select_idx\n-            select.append((annotation, alias))\n-            select_idx += 1\n+        if not getattr(self.query, 'subquery', False) or not self.query.is_empty():\n+            for alias, annotation in self.query.annotation_select.items():\n+                annotations[alias] = select_idx\n+                select.append((annotation, alias))\n+                select_idx += 1\n         if self.query.select_related:\n             related_klass_infos = self.get_related_selections(select, select_mask)\n             klass_info['related_klass_infos'] = related_klass_infos\n", "normalized_occurrence": 2}
