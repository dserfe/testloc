{"model_name_or_path": "agentless", "instance_id": "django__django-11532", "model_patch": "diff --git a/django/core/mail/message.py b/django/core/mail/message.py\nindex e5469be..35e6ca7 100644\n--- a/django/core/mail/message.py\n+++ b/django/core/mail/message.py\n@@ -64,6 +64,11 @@ def forbid_multi_line_headers(name, val, encoding):\n         if name.lower() in ADDRESS_HEADERS:\n             val = ', '.join(sanitize_address(addr, encoding) for addr in getaddresses((val,)))\n         else:\n+            # Convert domain part of the email to punycode if necessary\n+            if '@' in val:\n+                local_part, domain_part = val.rsplit('@', 1)\n+                domain_part = domain_part.encode('idna').decode('ascii')\n+                val = f\"{local_part}@{domain_part}\"\n             val = Header(val, encoding).encode()\n     else:\n         if name.lower() == 'subject':\n@@ -257,7 +262,10 @@ class EmailMessage:\n             msg['Date'] = formatdate(localtime=settings.EMAIL_USE_LOCALTIME)\n         if 'message-id' not in header_names:\n             # Use cached DNS_NAME for performance\n-            msg['Message-ID'] = make_msgid(domain=DNS_NAME)\n+            dns_name = DNS_NAME\n+            if isinstance(dns_name, str):\n+                dns_name = dns_name.encode('idna').decode('ascii')\n+            msg['Message-ID'] = make_msgid(domain=dns_name)\n         for name, value in self.extra_headers.items():\n             if name.lower() != 'from':  # From is already handled\n                 msg[name] = value\n", "occurrence": 1, "normalized_patch": "diff --git a/django/core/mail/message.py b/django/core/mail/message.py\nindex bf67640..500cb74 100644\n--- a/django/core/mail/message.py\n+++ b/django/core/mail/message.py\n@@ -34,6 +34,10 @@ def forbid_multi_line_headers(name, val, encoding):\n         if name.lower() in ADDRESS_HEADERS:\n             val = ', '.join((sanitize_address(addr, encoding) for addr in getaddresses((val,))))\n         else:\n+            if '@' in val:\n+                local_part, domain_part = val.rsplit('@', 1)\n+                domain_part = domain_part.encode('idna').decode('ascii')\n+                val = f'{local_part}@{domain_part}'\n             val = Header(val, encoding).encode()\n     else:\n         if name.lower() == 'subject':\n@@ -160,7 +164,10 @@ class EmailMessage:\n         if 'date' not in header_names:\n             msg['Date'] = formatdate(localtime=settings.EMAIL_USE_LOCALTIME)\n         if 'message-id' not in header_names:\n-            msg['Message-ID'] = make_msgid(domain=DNS_NAME)\n+            dns_name = DNS_NAME\n+            if isinstance(dns_name, str):\n+                dns_name = dns_name.encode('idna').decode('ascii')\n+            msg['Message-ID'] = make_msgid(domain=dns_name)\n         for name, value in self.extra_headers.items():\n             if name.lower() != 'from':\n                 msg[name] = value\n", "normalized_occurrence": 1}
