{"model_name_or_path": "agentless", "instance_id": "sympy__sympy-22840", "model_patch": "diff --git a/sympy/simplify/cse_main.py b/sympy/simplify/cse_main.py\nindex fa99708..6317da7 100644\n--- a/sympy/simplify/cse_main.py\n+++ b/sympy/simplify/cse_main.py\n@@ -787,8 +787,22 @@ def cse(exprs, symbols=None, optimizations=None, postprocess=None,\n     if isinstance(exprs, (Basic, MatrixBase)):\n         exprs = [exprs]\n \n+    from sympy.matrices.expressions.matexpr import MatrixElement\n+\n+    def _extract_matrix_elements(expr):\n+        if isinstance(expr, MatrixElement):\n+            return [expr]\n+        elif isinstance(expr, Basic):\n+            elements = []\n+            for arg in expr.args:\n+                elements.extend(_extract_matrix_elements(arg))\n+            return elements\n+        return []\n+\n     copy = exprs\n     temp = []\n+    for e in exprs:\n+        temp.extend(_extract_matrix_elements(e))\n     for e in exprs:\n         if isinstance(e, (Matrix, ImmutableMatrix)):\n             temp.append(Tuple(*e.flat()))\n", "occurrence": 1, "normalized_patch": "diff --git a/sympy/simplify/cse_main.py b/sympy/simplify/cse_main.py\nindex d5cc8d7..5d833f8 100644\n--- a/sympy/simplify/cse_main.py\n+++ b/sympy/simplify/cse_main.py\n@@ -310,8 +310,20 @@ def cse(exprs, symbols=None, optimizations=None, postprocess=None, order='canoni\n         exprs = sympify(exprs)\n     if isinstance(exprs, (Basic, MatrixBase)):\n         exprs = [exprs]\n+    from sympy.matrices.expressions.matexpr import MatrixElement\n+    def _extract_matrix_elements(expr):\n+        if isinstance(expr, MatrixElement):\n+            return [expr]\n+        elif isinstance(expr, Basic):\n+            elements = []\n+            for arg in expr.args:\n+                elements.extend(_extract_matrix_elements(arg))\n+            return elements\n+        return []\n     copy = exprs\n     temp = []\n+    for e in exprs:\n+        temp.extend(_extract_matrix_elements(e))\n     for e in exprs:\n         if isinstance(e, (Matrix, ImmutableMatrix)):\n             temp.append(Tuple(*e.flat()))\n", "normalized_occurrence": 1}
