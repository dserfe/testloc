{"model_name_or_path": "agentless", "instance_id": "sympy__sympy-22840", "model_patch": "diff --git a/sympy/simplify/cse_main.py b/sympy/simplify/cse_main.py\nindex fa99708..e2920ab 100644\n--- a/sympy/simplify/cse_main.py\n+++ b/sympy/simplify/cse_main.py\n@@ -794,11 +794,18 @@ def cse(exprs, symbols=None, optimizations=None, postprocess=None,\n             temp.append(Tuple(*e.flat()))\n         elif isinstance(e, (SparseMatrix, ImmutableSparseMatrix)):\n             temp.append(Tuple(*e.todok().items()))\n+        elif isinstance(e, MatrixSymbol):\n+            temp.append(e)\n         else:\n             temp.append(e)\n     exprs = temp\n     del temp\n \n+def _rebuild(expr):\n+    if isinstance(expr, MatrixSymbol):\n+        return expr\n+    return expr.func(*[_rebuild(arg) for arg in expr.args])\n+\n     if optimizations is None:\n         optimizations = []\n     elif optimizations == 'basic':\n", "occurrence": 1, "normalized_patch": "diff --git a/sympy/simplify/cse_main.py b/sympy/simplify/cse_main.py\nindex d5cc8d7..2df1314 100644\n--- a/sympy/simplify/cse_main.py\n+++ b/sympy/simplify/cse_main.py\n@@ -317,10 +317,16 @@ def cse(exprs, symbols=None, optimizations=None, postprocess=None, order='canoni\n             temp.append(Tuple(*e.flat()))\n         elif isinstance(e, (SparseMatrix, ImmutableSparseMatrix)):\n             temp.append(Tuple(*e.todok().items()))\n+        elif isinstance(e, MatrixSymbol):\n+            temp.append(e)\n         else:\n             temp.append(e)\n     exprs = temp\n     del temp\n+def _rebuild(expr):\n+    if isinstance(expr, MatrixSymbol):\n+        return expr\n+    return expr.func(*[_rebuild(arg) for arg in expr.args])\n     if optimizations is None:\n         optimizations = []\n     elif optimizations == 'basic':\n", "normalized_occurrence": 1}
