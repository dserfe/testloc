{"model_name_or_path": "agentless", "instance_id": "matplotlib__matplotlib-20676", "model_patch": "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..7f223a2 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2280,10 +2280,15 @@ class SpanSelector(_SelectorWidget):\n     def _draw_shape(self, vmin, vmax):\n         if vmin > vmax:\n             vmin, vmax = vmax, vmin\n+        # Ensure that the rectangle is drawn within the current axis limits\n         if self.direction == 'horizontal':\n+            vmin = max(vmin, self.ax.get_xlim()[0])\n+            vmax = min(vmax, self.ax.get_xlim()[1])\n             self._rect.set_x(vmin)\n             self._rect.set_width(vmax - vmin)\n         else:\n+            vmin = max(vmin, self.ax.get_ylim()[0])\n+            vmax = min(vmax, self.ax.get_ylim()[1])\n             self._rect.set_y(vmin)\n             self._rect.set_height(vmax - vmin)\n \n", "occurrence": 1, "normalized_patch": "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex b2dd641..cc0b7f6 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -1859,9 +1859,13 @@ class SpanSelector(_SelectorWidget):\n         if vmin > vmax:\n             vmin, vmax = (vmax, vmin)\n         if self.direction == 'horizontal':\n+            vmin = max(vmin, self.ax.get_xlim()[0])\n+            vmax = min(vmax, self.ax.get_xlim()[1])\n             self._rect.set_x(vmin)\n             self._rect.set_width(vmax - vmin)\n         else:\n+            vmin = max(vmin, self.ax.get_ylim()[0])\n+            vmax = min(vmax, self.ax.get_ylim()[1])\n             self._rect.set_y(vmin)\n             self._rect.set_height(vmax - vmin)\n \n", "normalized_occurrence": 1}
