{"model_name_or_path": "agentless", "instance_id": "sympy__sympy-17630", "model_patch": "diff --git a/sympy/matrices/expressions/blockmatrix.py b/sympy/matrices/expressions/blockmatrix.py\nindex 5a4ea29..05197f4 100644\n--- a/sympy/matrices/expressions/blockmatrix.py\n+++ b/sympy/matrices/expressions/blockmatrix.py\n@@ -94,11 +94,16 @@ class BlockMatrix(MatrixExpr):\n             # same number of matrices in each row\n             blocky = ok = len(set([len(r) for r in rows])) == 1\n             if ok:\n-                # same number of rows for each matrix in a row\n+                # same number of rows and columns for each matrix in a row\n                 for r in rows:\n-                    ok = len(set([i.rows for i in r])) == 1\n+                    ok = len(set([i.rows for i in r if isMat(i)])) == 1\n                     if not ok:\n                         break\n+                if ok:\n+                    for c in range(len(rows[0])):\n+                        ok = len(set([rows[i][c].cols for i in range(len(rows)) if isMat(rows[i][c])])) == 1\n+                        if not ok:\n+                            break\n                 blocky = ok\n                 # same number of cols for each matrix in each col\n                 for c in range(len(rows[0])):\n", "occurrence": 1, "normalized_patch": "diff --git a/sympy/matrices/expressions/blockmatrix.py b/sympy/matrices/expressions/blockmatrix.py\nindex c0f9049..21903bc 100644\n--- a/sympy/matrices/expressions/blockmatrix.py\n+++ b/sympy/matrices/expressions/blockmatrix.py\n@@ -31,9 +31,14 @@ class BlockMatrix(MatrixExpr):\n             blocky = ok = len(set([len(r) for r in rows])) == 1\n             if ok:\n                 for r in rows:\n-                    ok = len(set([i.rows for i in r])) == 1\n+                    ok = len(set([i.rows for i in r if isMat(i)])) == 1\n                     if not ok:\n                         break\n+                if ok:\n+                    for c in range(len(rows[0])):\n+                        ok = len(set([rows[i][c].cols for i in range(len(rows)) if isMat(rows[i][c])])) == 1\n+                        if not ok:\n+                            break\n                 blocky = ok\n                 for c in range(len(rows[0])):\n                     ok = len(set([rows[i][c].cols for i in range(len(rows))])) == 1\n", "normalized_occurrence": 1}
