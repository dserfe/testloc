{"model_name_or_path": "agentless_claude", "instance_id": "sympy__sympy-13915", "model_patch": "diff --git a/sympy/core/basic.py b/sympy/core/basic.py\nindex 0977e81..b9b2b78 100644\n--- a/sympy/core/basic.py\n+++ b/sympy/core/basic.py\n@@ -1009,6 +1009,9 @@ class Basic(with_metaclass(ManagedProperties)):\n                     args[i] = arg\n             if hit:\n                 rv = self.func(*args)\n+                # Check for undefined expressions after substitution\n+                if rv.has(S.NaN) or rv.has(S.ComplexInfinity):\n+                    return S.NaN\n                 hack2 = hints.get('hack2', False)\n                 if hack2 and self.is_Mul and not rv.is_Mul:  # 2-arg hack\n                     coeff = S.One\n", "occurrence": 1, "normalized_patch": "diff --git a/sympy/core/basic.py b/sympy/core/basic.py\nindex 782db85..82d49c7 100644\n--- a/sympy/core/basic.py\n+++ b/sympy/core/basic.py\n@@ -344,6 +344,8 @@ class Basic(with_metaclass(ManagedProperties)):\n                     args[i] = arg\n             if hit:\n                 rv = self.func(*args)\n+                if rv.has(S.NaN) or rv.has(S.ComplexInfinity):\n+                    return S.NaN\n                 hack2 = hints.get('hack2', False)\n                 if hack2 and self.is_Mul and (not rv.is_Mul):\n                     coeff = S.One\n", "normalized_occurrence": 1}
