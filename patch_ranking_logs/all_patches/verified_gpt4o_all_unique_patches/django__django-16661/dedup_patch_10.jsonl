{"model_name_or_path": "agentless", "instance_id": "django__django-16661", "model_patch": "diff --git a/django/contrib/admin/options.py b/django/contrib/admin/options.py\nindex 20a301b..5a5f695 100644\n--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -481,15 +481,22 @@ class BaseModelAdmin(metaclass=forms.MediaDefiningClass):\n             return True\n         valid_lookups = {self.date_hierarchy}\n         for filter_item in self.list_filter:\n-            if isinstance(filter_item, type) and issubclass(\n-                filter_item, SimpleListFilter\n-            ):\n+            if isinstance(filter_item, type) and issubclass(filter_item, SimpleListFilter):\n                 valid_lookups.add(filter_item.parameter_name)\n             elif isinstance(filter_item, (list, tuple)):\n                 valid_lookups.add(filter_item[0])\n             else:\n                 valid_lookups.add(filter_item)\n \n+        # Handle foreign key as primary key case\n+        concrete_model = model._meta.concrete_model\n+        if model != concrete_model:\n+            relation_parts = [\n+                part\n+                for part in relation_parts\n+                if concrete_model._meta.get_field(part).related_model != model\n+            ]\n+\n         # Is it a valid relational lookup?\n         return not {\n             LOOKUP_SEP.join(relation_parts),\n", "occurrence": 1, "normalized_patch": "diff --git a/django/contrib/admin/options.py b/django/contrib/admin/options.py\nindex 061e1b9..b744568 100644\n--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -221,6 +221,9 @@ class BaseModelAdmin(metaclass=forms.MediaDefiningClass):\n                 valid_lookups.add(filter_item[0])\n             else:\n                 valid_lookups.add(filter_item)\n+        concrete_model = model._meta.concrete_model\n+        if model != concrete_model:\n+            relation_parts = [part for part in relation_parts if concrete_model._meta.get_field(part).related_model != model]\n         return not {LOOKUP_SEP.join(relation_parts), LOOKUP_SEP.join(relation_parts + [part])}.isdisjoint(valid_lookups)\n     def to_field_allowed(self, request, to_field):\n         try:\n", "normalized_occurrence": 1}
