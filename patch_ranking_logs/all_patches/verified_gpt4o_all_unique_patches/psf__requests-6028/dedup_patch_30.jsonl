{"model_name_or_path": "agentless", "instance_id": "psf__requests-6028", "model_patch": "diff --git a/requests/sessions.py b/requests/sessions.py\nindex 594e72b..eaf02b5 100644\n--- a/requests/sessions.py\n+++ b/requests/sessions.py\n@@ -516,9 +516,16 @@ class Session(SessionRedirectMixin):\n \n         proxies = proxies or {}\n \n+        # Ensure proxy authentication is set up correctly\n         settings = self.merge_environment_settings(\n             prep.url, proxies, stream, verify, cert\n         )\n+        \n+        if 'proxy' in settings and settings['proxy']:\n+            # Ensure the Proxy-Authorization header is added if proxy credentials are provided\n+            proxy_scheme = urlparse(settings['proxy']).scheme\n+            if proxy_scheme in proxies and '@' in proxies[proxy_scheme]:\n+                settings['proxies'][proxy_scheme] = proxies[proxy_scheme]\n \n         # Send the request.\n         send_kwargs = {\n", "occurrence": 1, "normalized_patch": "diff --git a/requests/sessions.py b/requests/sessions.py\nindex 65aa332..2ac904c 100644\n--- a/requests/sessions.py\n+++ b/requests/sessions.py\n@@ -183,6 +183,10 @@ class Session(SessionRedirectMixin):\n         prep = self.prepare_request(req)\n         proxies = proxies or {}\n         settings = self.merge_environment_settings(prep.url, proxies, stream, verify, cert)\n+        if 'proxy' in settings and settings['proxy']:\n+            proxy_scheme = urlparse(settings['proxy']).scheme\n+            if proxy_scheme in proxies and '@' in proxies[proxy_scheme]:\n+                settings['proxies'][proxy_scheme] = proxies[proxy_scheme]\n         send_kwargs = {'timeout': timeout, 'allow_redirects': allow_redirects}\n         send_kwargs.update(settings)\n         resp = self.send(prep, **send_kwargs)\n", "normalized_occurrence": 1}
