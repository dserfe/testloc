{"model_name_or_path": "agentless", "instance_id": "pydata__xarray-3364", "model_patch": "diff --git a/xarray/core/concat.py b/xarray/core/concat.py\nindex 1ac1b8e..905a978 100644\n--- a/xarray/core/concat.py\n+++ b/xarray/core/concat.py\n@@ -1,3 +1,4 @@\n+\n import pandas as pd\n \n from . import dtypes, utils\n@@ -286,11 +287,14 @@ def _dataset_concat(\n     dim_names = set(dim_coords)\n     unlabeled_dims = dim_names - coord_names\n \n-    both_data_and_coords = coord_names & data_names\n-    if both_data_and_coords:\n-        raise ValueError(\n-            \"%r is a coordinate in some datasets but not others.\" % both_data_and_coords\n-        )\n+    # Ensure all datasets have the same set of variables\n+    all_vars = set()\n+    for ds in datasets:\n+        all_vars.update(ds.variables)\n+\n+    for ds in datasets:\n+        for var in all_vars - set(ds.variables):\n+            ds[var] = ds._fill_variable_with_nan(var, dims_sizes)\n     # we don't want the concat dimension in the result dataset yet\n     dim_coords.pop(dim, None)\n     dims_sizes.pop(dim, None)\n", "occurrence": 1, "normalized_patch": "diff --git a/xarray/core/concat.py b/xarray/core/concat.py\nindex 06e5a50..6ebfe12 100644\n--- a/xarray/core/concat.py\n+++ b/xarray/core/concat.py\n@@ -113,9 +113,12 @@ def _dataset_concat(datasets, dim, data_vars, coords, compat, positions, fill_va\n     dim_coords, dims_sizes, coord_names, data_names = _parse_datasets(datasets)\n     dim_names = set(dim_coords)\n     unlabeled_dims = dim_names - coord_names\n-    both_data_and_coords = coord_names & data_names\n-    if both_data_and_coords:\n-        raise ValueError('%r is a coordinate in some datasets but not others.' % both_data_and_coords)\n+    all_vars = set()\n+    for ds in datasets:\n+        all_vars.update(ds.variables)\n+    for ds in datasets:\n+        for var in all_vars - set(ds.variables):\n+            ds[var] = ds._fill_variable_with_nan(var, dims_sizes)\n     dim_coords.pop(dim, None)\n     dims_sizes.pop(dim, None)\n     if (dim in coord_names or dim in data_names) and dim not in dim_names:\n", "normalized_occurrence": 1}
