{"model_name_or_path": "agentless", "instance_id": "django__django-16910", "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 364ef3b..0a04c0a 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -1229,8 +1229,9 @@ class SQLCompiler:\n                 related_select_mask, start_alias=alias, opts=f.remote_field.model._meta\n             )\n             for col in columns:\n-                select_fields.append(len(select))\n-                select.append((col, None))\n+                if select_related_descend(f, restricted, requested):\n+                    select_fields.append(len(select))\n+                    select.append((col, None))\n             klass_info[\"select_fields\"] = select_fields\n             next_klass_infos = self.get_related_selections(\n                 select,\n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 802130c..a0b2425 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -618,8 +618,9 @@ class SQLCompiler:\n             alias = joins[-1]\n             columns = self.get_default_columns(related_select_mask, start_alias=alias, opts=f.remote_field.model._meta)\n             for col in columns:\n-                select_fields.append(len(select))\n-                select.append((col, None))\n+                if select_related_descend(f, restricted, requested):\n+                    select_fields.append(len(select))\n+                    select.append((col, None))\n             klass_info['select_fields'] = select_fields\n             next_klass_infos = self.get_related_selections(select, related_select_mask, f.remote_field.model._meta, alias, cur_depth + 1, next, restricted)\n             get_related_klass_infos(klass_info, next_klass_infos)\n", "normalized_occurrence": 1}
