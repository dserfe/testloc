{"model_name_or_path": "agentless_claude", "instance_id": "django__django-16032", "model_patch": "diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex 250c6ee..ecbbe83 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1148,7 +1148,11 @@ class Query(BaseExpression):\n         return clone\n \n     def get_external_cols(self):\n-        exprs = chain(self.annotations.values(), self.where.children)\n+        if getattr(self, 'subquery', False) and not self.group_by:\n+            # For __in subqueries without GROUP BY, only include WHERE conditions\n+            exprs = self.where.children\n+        else:\n+            exprs = chain(self.annotations.values(), self.where.children)\n         return [\n             col\n             for col in self._gen_cols(exprs, include_external=True)\n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex 4a84de0..c9561a1 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -595,7 +595,10 @@ class Query(BaseExpression):\n             clone.external_aliases[alias] = isinstance(table, Join) and table.join_field.related_model._meta.db_table != alias or (isinstance(table, BaseTable) and table.table_name != table.table_alias)\n         return clone\n     def get_external_cols(self):\n-        exprs = chain(self.annotations.values(), self.where.children)\n+        if getattr(self, 'subquery', False) and (not self.group_by):\n+            exprs = self.where.children\n+        else:\n+            exprs = chain(self.annotations.values(), self.where.children)\n         return [col for col in self._gen_cols(exprs, include_external=True) if col.alias in self.external_aliases]\n     def get_group_by_cols(self, alias=None):\n         if alias:\n", "normalized_occurrence": 1}
