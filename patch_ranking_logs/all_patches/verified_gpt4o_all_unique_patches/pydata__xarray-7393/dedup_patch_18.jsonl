{"model_name_or_path": "agentless", "instance_id": "pydata__xarray-7393", "model_patch": "diff --git a/xarray/core/indexes.py b/xarray/core/indexes.py\nindex d49b2c1..c3e82d6 100644\n--- a/xarray/core/indexes.py\n+++ b/xarray/core/indexes.py\n@@ -706,7 +706,8 @@ class PandasMultiIndex(PandasIndex):\n                     f\"from variable {name!r} that wraps a multi-index\"\n                 )\n \n-        split_labels, levels = zip(*[lev.factorize() for lev in level_indexes])\n+        split_labels, levels = zip(*[lev.factorize(sort=True) for lev in level_indexes])\n+        levels = [np.asarray(level, dtype=variables[k].dtype) for k, level in zip(variables, levels)]\n         labels_mesh = np.meshgrid(*split_labels, indexing=\"ij\")\n         labels = [x.ravel() for x in labels_mesh]\n \n@@ -721,7 +722,7 @@ class PandasMultiIndex(PandasIndex):\n         new_indexes: dict[Hashable, Index] = {}\n         for name, lev in zip(clean_index.names, clean_index.levels):\n             idx = PandasIndex(\n-                lev.copy(), name, coord_dtype=self.level_coords_dtype[name]\n+                np.asarray(lev, dtype=self.level_coords_dtype[name]), name, coord_dtype=self.level_coords_dtype[name]\n             )\n             new_indexes[name] = idx\n \n", "occurrence": 1, "normalized_patch": "diff --git a/xarray/core/indexes.py b/xarray/core/indexes.py\nindex 6be2e3c..e52bc90 100644\n--- a/xarray/core/indexes.py\n+++ b/xarray/core/indexes.py\n@@ -371,7 +371,8 @@ class PandasMultiIndex(PandasIndex):\n         for name, idx in zip(variables, level_indexes):\n             if isinstance(idx, pd.MultiIndex):\n                 raise ValueError(f'cannot create a multi-index along stacked dimension {dim!r} from variable {name!r} that wraps a multi-index')\n-        split_labels, levels = zip(*[lev.factorize() for lev in level_indexes])\n+        split_labels, levels = zip(*[lev.factorize(sort=True) for lev in level_indexes])\n+        levels = [np.asarray(level, dtype=variables[k].dtype) for k, level in zip(variables, levels)]\n         labels_mesh = np.meshgrid(*split_labels, indexing='ij')\n         labels = [x.ravel() for x in labels_mesh]\n         index = pd.MultiIndex(levels, labels, sortorder=0, names=variables.keys())\n@@ -381,7 +382,7 @@ class PandasMultiIndex(PandasIndex):\n         clean_index = remove_unused_levels_categories(self.index)\n         new_indexes: dict[Hashable, Index] = {}\n         for name, lev in zip(clean_index.names, clean_index.levels):\n-            idx = PandasIndex(lev.copy(), name, coord_dtype=self.level_coords_dtype[name])\n+            idx = PandasIndex(np.asarray(lev, dtype=self.level_coords_dtype[name]), name, coord_dtype=self.level_coords_dtype[name])\n             new_indexes[name] = idx\n         return (new_indexes, clean_index)\n     @classmethod\n", "normalized_occurrence": 1}
