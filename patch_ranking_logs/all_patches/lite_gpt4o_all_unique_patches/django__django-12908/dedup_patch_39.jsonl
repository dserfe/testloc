{"model_name_or_path": "agentless", "instance_id": "django__django-12908", "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex a26bee7..cc988b2 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -479,6 +479,10 @@ class SQLCompiler:\n         params = []\n         for part in args_parts:\n             params.extend(part)\n+        distinct_fields_sql, distinct_params = self.get_distinct()\n+        if distinct_fields_sql:\n+            result.insert(0, 'SELECT DISTINCT ON ({})'.format(', '.join(distinct_fields_sql)))\n+            params = distinct_params + params\n         return result, params\n \n     def as_sql(self, with_limits=True, with_col_aliases=False):\n@@ -699,6 +703,10 @@ class SQLCompiler:\n                     r, p = self.compile(transform_function(target, alias))\n                     result.append(r)\n                     params.append(p)\n+        distinct_fields_sql, distinct_params = self.get_distinct()\n+        if distinct_fields_sql:\n+            result.insert(0, 'SELECT DISTINCT ON ({})'.format(', '.join(distinct_fields_sql)))\n+            params = distinct_params + params\n         return result, params\n \n     def find_ordering_name(self, name, opts, alias=None, default_order='ASC',\n", "occurrence": 1, "normalized_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex e6a07a3..aa84152 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -271,6 +271,10 @@ class SQLCompiler:\n         params = []\n         for part in args_parts:\n             params.extend(part)\n+        distinct_fields_sql, distinct_params = self.get_distinct()\n+        if distinct_fields_sql:\n+            result.insert(0, 'SELECT DISTINCT ON ({})'.format(', '.join(distinct_fields_sql)))\n+            params = distinct_params + params\n         return (result, params)\n     def as_sql(self, with_limits=True, with_col_aliases=False):\n         refcounts_before = self.query.alias_refcount.copy()\n@@ -404,6 +408,10 @@ class SQLCompiler:\n                     r, p = self.compile(transform_function(target, alias))\n                     result.append(r)\n                     params.append(p)\n+        distinct_fields_sql, distinct_params = self.get_distinct()\n+        if distinct_fields_sql:\n+            result.insert(0, 'SELECT DISTINCT ON ({})'.format(', '.join(distinct_fields_sql)))\n+            params = distinct_params + params\n         return (result, params)\n     def find_ordering_name(self, name, opts, alias=None, default_order='ASC', already_seen=None):\n         name, order = get_order_dir(name, default_order)\n", "normalized_occurrence": 1}
